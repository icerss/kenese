"use strict";(self.webpackChunk_icerss_kenese=self.webpackChunk_icerss_kenese||[]).push([[706],{246:function(e,t,i){var n=i(865);!async function(){await(0,n.Z)()}()},510:function(e,t,i){i.d(t,{r:function(){return h}});var n=i(233),s=i(931),o=i(700),r=i.n(o),a=i(783),c=i(533);let d={};class u{constructor(e){this.uid=(0,c.x0)();const t=document.createElement("div"),i=new Image;t.className="krz-object",t.style.display=e.isShow?"block":"none",t.setAttribute("data-id",this.uid),i.className="krz-object-img",i.src=e.img,e.width&&(i.width=e.width),e.height&&(i.height=e.height),t.style.left=e.x+"px",t.style.top=e.y+"px",t.appendChild(i),document.querySelector(".krz-object-container").appendChild(t),this.img=e.img,this.element=t,this.imageElement=i,this.isShow=e.isShow||!0,this.isAnimating=!1,this.name=e.name,this.description=e.description,this.isItem=e.isItem,this.isSelectAsItem=!1,(e.description||this.isItem)&&this.onclick(async function(){if(this.isItem&&(await(0,n.KF)(this),function(e){let t=document.createElement("div");t.className="krz-item",t.setAttribute("data-id",e.uid);let i=new Image;i.src=e.img,i.className="krz-item-img",t.appendChild(i),s.jD.appendChild(t),function(e){let t=!1,i=0,n=0,o=0,u=0;function h(s){s.preventDefault(),i=s.clientX||s.changedTouches[0].pageX,n=s.clientY||s.changedTouches[0].pageY,o=e.offsetLeft,u=e.offsetTop,t=!0,(0,c.cM)("开始拖动物品",{name:"",uid:e.getAttribute("data-id")})}function l(r){if(r.preventDefault(),!t||a.s.isAnimating)return;e.classList.add("krz-item-drag");let h=r.clientX||r.changedTouches[0].pageX,l=(r.clientY||r.changedTouches[0].pageY)-(n-u),m=(h-(i-o))/a.s.scale,f=l/a.s.scale;e.style.left=m+"px",e.style.top=f+"px";for(let t in d){let i=d[t].obj,n=e,o=d[t].func;if(n.getAttribute("data-id")!==t)continue;let r=i.element,a=n,u=s.jD.offsetLeft+a.offsetLeft,h=r.offsetLeft,m=r.offsetLeft+r.offsetWidth,f=l,g=r.offsetTop,p=r.offsetTop+r.clientHeight,w=u+a.clientWidth>h,y=u<m,v=f+a.clientHeight>g,k=f+a.clientHeight<p;w&&y&&v&&k&&((0,c.cM)("触碰到匹配的物品",{name:i.name||"",uid:i.uid}),"function"==typeof o&&o())}}function m(i){i.preventDefault(),t&&(e.classList.remove("krz-item-drag"),e.removeAttribute("style"),t=!1,(0,c.cM)("停止拖动物品",{name:"",uid:e.getAttribute("data-id")}))}e.addEventListener("mousedown",h),e.addEventListener("touchstart",h),s.lw.addEventListener("mousemove",r()(l,10)),s.lw.addEventListener("touchmove",r()(l,10)),s.lw.addEventListener("mouseup",m),s.lw.addEventListener("touchend",m)}(t),e.remove(),(0,c.cM)("添加物品到物品栏",{name:e.name,uid:e.uid})}(this)),e.description)if("object"==typeof this.description)for(let e of this.description)await a.s.dialog(e);else await a.s.dialog(this.description)}.bind(this)),(0,c.cM)("放置物品：",{name:this.name||"",uid:this.uid})}show(){return(0,c.cM)("显示物品",{name:this.name||"",uid:this.uid}),this.isShow=!0,(this.element.style.display="block")&&this}hide(){return(0,c.cM)("隐藏物品",{name:this.name||"",uid:this.uid}),this.isShow=!1,(this.element.style.display="none")&&this}remove(){return(0,c.cM)("移除物品",{name:this.name||"",uid:this.uid}),this.isShow=!1,this.element.remove()&&this}setX(e){return(this.element.style.left=e+"px")&&this}setY(e){return(this.element.style.top=e+"px")&&this}setWidth(e){return(this.imageElement.width=e)&&this}setHeight(e){return(this.imageElement.height=e)&&this}setImage(e){return(this.imageElement.src=e)&&this}moveTo(e,t,i=2){return(0,c.cM)("物品动画开始",{name:this.name||"",uid:this.uid}),this.isAnimating=!0,new Promise(function(n){this.element.style.transition=`ease-in-out ${i}s`,this.setX(e),this.setY(t),setTimeout(function(){this.element.style.transition="unset",this.isAnimating=!1,(0,c.cM)("物品动画结束",{name:this.name||"",uid:this.uid}),n()}.bind(this),1e3*i)}.bind(this))}goTo(e,t){return this.setX(e),this.setY(t),this}onclick(e){return(0,c.cM)("添加监听点击事件",{name:this.name||"",uid:this.uid}),this.element.addEventListener("click",(function(t){a.s.isAnimating||"function"==typeof e&&e(t)}))}clicked(){return new Promise(function(e){(0,c.cM)("等待物品被点击",{name:this.name||"",uid:this.uid}),this.onclick(e)}.bind(this))}touch(e){return new Promise(async function(t){(0,c.cM)("等待物品执行拖动触碰",{name:this.name||"",uid:this.uid}),function(e,t,i){d[e.uid]={obj:t,func:i},(0,c.cM)("添加物品到监听碰撞列表",{name:e.name,uid:e.uid})}(this,e,t)}.bind(this))}isShow(){return this.isShow}isAnimating(){return this.isAnimating}showInfoHighlight(){return(0,n.QH)(this)}hideInfoHighlight(){return(0,n.ts)(this)}}function h(e){return new u(e)}},783:function(e,t,i){i.d(t,{s:function(){return d}});var n=i(931),s=i(510),o=i(571),r=i.n(o),a=i(533),c=i(905);const d=new class{constructor(){this.scale=1,this._handleCanvasSize(),window.addEventListener("resize",r()(this._handleCanvasSize,100)),this.isAnimating=!1,(0,a.cM)("初始化屏幕")}_handleCanvasSize(){const e=window.innerHeight,t=window.innerWidth;this.scale=Math.min(e/600,t/900),n.lw.style.height="600px",n.lw.style.width="900px",n.lw.style.transform=`scale(${this.scale})`,(0,a.cM)("调整屏幕尺寸")}place(e={x:0,y:0,img:"",width:0,height:0,name:"",description:[],isShow:!0,isItem:!1}){return(0,s.r)(e)}background(e){this.backgroungImage=e,n.lw.style.backgroundImage=`url("${e}")`,(0,a.cM)("设置背景图片")}showLoadingAnimation(){n.ay.innerHTML='\n<div class="krz-loading ">\n    <img class="krz-loading-img krz-animate-pulse"\n        src="https://s-sh-1943-mingyan-static.oss.dogecdn.com/image/public/logo-v2/256x256.png">\n    <div class="krz-loading-text">加载资源中……</div>\n</div>',n.ay.style.display="block",(0,a.cM)("显示加载中页面")}hideLoadingAnimation(){n.ay.innerHTML="",n.ay.style.display="none",(0,a.cM)("隐藏加载中页面")}preFetch(e){return(0,a.ns)(e)}fullInfo(e){return async function(e){return(0,a.cM)("开始展示全屏幕文字",{text:e}),d.setStartAnimation(),new Promise((async function(t){n.T8.innerHTML='\n  <div class="krz-screen-info-words">\n      <div class="krz-screen-info-words-print"></div>\n  </div>',n.T8.style.display="flex",e=(e=e.replace(/(，|。|\\n)/gi,"$1\n")).split("\n");for(let t of e){let e=document.createElement("div");e.className="krz-screen-info-text",document.querySelector(".krz-screen-info-words-print").appendChild(e),t=t.split("");for(let i of t)await(0,c.a)(e,i,{waitTime:50}),document.querySelector(".krz-screen-info-words-print").clientHeight>n.T8.clientHeight&&document.querySelector(".krz-screen-info-text:first-child").remove()}document.querySelector(".krz-screen-info").addEventListener("click",(function(){document.querySelector(".krz-screen-info").classList.add("krz-animate-fadeOut"),setTimeout((function(){n.T8.style.display="none",document.querySelector(".krz-screen-info").classList.remove("krz-animate-fadeOut"),(0,a.cM)("结束展示全屏幕文字"),d.setStopAnimation(),t()}),500)}))}))}(e)}dialog(e){return(0,c.v)(e)}setStartAnimation(){return(0,a.cM)("开始执行动画，任务挂起"),this.isAnimating=!0}setStopAnimation(){return(0,a.cM)("结束执行动画，任务继续"),this.isAnimating=!1}}},533:function(e,t,i){i.d(t,{cM:function(){return s},ns:function(){return o},x0:function(){return r}});var n=i(450);const s=function(){let e=0;return function(){e++,console.log(`[${(new Date).getHours()}:${(new Date).getMinutes()}]#${e} ->`,...arguments)}}();function o(e){s("预加载资源");let t=[];for(let i in e)t.push(e[i]);return Promise.all(t.map((function(e){return new Promise((function(t){let i=new Image;i.src=e,i.addEventListener("load",t)}))})))}window.log=s;const r=(0,n.kP)("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",8)}},function(e){e.O(0,[797,19,771],(function(){return 246,e(e.s=246)})),e.O()}]);